!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Pjax=e()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function i(t){return function(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}Array.prototype.from||(Array.prototype.from=function(t){for(var e=[],o=t.length;o--;e.unshift(t[o]));return e});var r,s=function(t,e,o){return t instanceof HTMLCollection||t instanceof NodeList||t instanceof Array?Array.prototype.from(t).forEach(function(t,n){return e.call(o,t,n)}):e.call(o,t)},a=function(t){return t.querySelectorAll(this.options.elements)},l=function(e){if(null===e||"object"!=t(e))return e;var o=e.constructor();for(var n in e)n in e&&(o[n]=e[n]);return o},c=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)},u=(r=0,function(){var t="pjax"+(new Date).getTime()+"_"+r;return r++,t});function h(t,e,o,n){(e="string"==typeof e?e.split(" "):e).forEach(function(e){s(t,function(t){t.addEventListener(e,o,n)})})}var p=function(){function t(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e(this,t),this.param=o,this.silencer=n,this.collector=[],this.currentGroupDescription="",this.activeGroups=0,this.timeHolder=null,this.methods=["group","groupEnd","log","trace","time","timeEnd","error","warn"],this.silent={group:function(){},groupEnd:function(){},log:function(){},trace:function(){},time:function(){},timeEnd:function(){},error:function(){},err:function(){},debug:function(){},warn:function(){}}}return n(t,[{key:"_generateError",value:function(){try{throw new Error}catch(t){return t}}},{key:"_insertParamToArguments",value:function(t){if(""!==this.param){var e=i(t);return e.unshift(this.param),e}return Array.from(arguments)}},{key:"setSilent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.silencer=t||!this.silencer}},{key:"group",value:function(){if(!this.silencer){var t=this._insertParamToArguments(arguments);if("function"!=typeof console.group){var e=t[0]||"GROUP";this.currentGroupDescription=e,this.activeGroups++}else console.group.apply(console,t)}}},{key:"groupEnd",value:function(){if(!this.silencer){var t=this._insertParamToArguments(arguments);"function"!=typeof console.groupEnd?(this.currentGroupDescription="",this.activeGroups--,this.activeGroups=0===this.activeGroups?0:this.activeGroups--):console.groupEnd.apply(console,t)}}},{key:"log",value:function(){if(!this.silencer){var t=this._insertParamToArguments(arguments);"function"!=typeof console.group?(t.shift(),t.unshift(" ".repeat(2*this.activeGroups)),this.log.apply(this,t)):console.log.apply(console,t)}}},{key:"trace",value:function(){if(!this.silencer){var t=this._insertParamToArguments(arguments);if("function"!=typeof console.trace){var e=this._generateError();e.stack?this.log.apply(console,e.stack):(this.log.log(t),null!=arguments.callee&&this.trace.apply(console,arguments.callee))}else console.trace.apply(console,t)}}},{key:"time",value:function(){if(!this.silencer){var t=this._insertParamToArguments(arguments);"function"!=typeof console.time?this.timeHolder=new Date:console.time.apply(console,t)}}},{key:"timeEnd",value:function(){if(!this.silencer){var t=this._insertParamToArguments(arguments);if("function"!=typeof console.timeEnd){var e=new Date-this.timeHolder;this.log.log("Took ".concat(Math.floor(e/36e5)," hours, ").concat(Math.floor(e/6e4)," minutes and ").concat(Math.floor(e/1e3)," seconds ( ").concat(e," ms)")),this.time=new Date}else console.timeEnd.apply(console,t)}}},{key:"error",value:function(){var t=this._insertParamToArguments(arguments);"function"!=typeof console.error?(this.log.log("--- ERROR ---"),this.log.log(t)):console.error.apply(console,t)}},{key:"warn",value:function(){var t=this._insertParamToArguments(arguments);"function"!=typeof console.warn?(this.log.log("--- WARN ---"),this.log.log(t)):console.warn.apply(console,t)}}]),t}();function f(t,e,o){(e="string"==typeof e?e.split(" "):e).forEach(function(e){var n;(n=document.createEvent("HTMLEvents")).initEvent(e,!0,!0),n.eventName=e,o&&Object.keys(o).forEach(function(t){n[t]=o[t]}),s(t,function(t){var e=!1;t.parentNode||t===document||t===window||(e=!0,document.body.appendChild(t)),t.dispatchEvent(n),e&&t.parentNode.removeChild(t)})})}function d(t,e,o){var n=(e=e||{}).requestMethod||"GET",i=e.requestPayloadString||null,r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&(200===r.status?o(r.responseText,r):o(null,r))},this.options.cacheBust&&(t+=(/[?&]/.test(t)?"&":"?")+(new Date).getTime()),r.open(n.toUpperCase(),t,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),null!=e.requestPayloadString&&""!=e.requestPayloadString&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(i),r}var m={outerHTML:function(t,e){t.outerHTML=e.outerHTML,this.onSwitch()},innerHTML:function(t,e){t.innerHTML=e.innerHTML,t.className=e.className,this.onSwitch()},sideBySide:function(t,e,o,n){var i=[],r=[],s=document.createDocumentFragment(),a="animationend webkitAnimationEnd MSAnimationEnd oanimationend",l=0,c=function(t){t.target==t.currentTarget&&--l<=0&&i&&(i.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)}),r.forEach(function(t){t.className=t.className.replace(t.getAttribute("data-pjax-classes"),""),t.removeAttribute("data-pjax-classes")}),r=null,i=null,this.onSwitch())}.bind(this);n=n||{},Array.from(t.childNodes).forEach(function(t){i.push(t),t.classList&&!t.classList.contains("js-Pjax-remove")&&(t.hasAttribute("data-pjax-classes")&&(t.className=t.className.replace(t.getAttribute("data-pjax-classes"),""),t.removeAttribute("data-pjax-classes")),t.classList.add("js-Pjax-remove"),n.callbacks&&n.callbacks.removeElement&&n.callbacks.removeElement(t),n.classNames&&(t.className+=" "+n.classNames.remove+" "+(o.backward?n.classNames.backward:n.classNames.forward)),l++,h(t,a,c,!0))}),Array.from(e.childNodes).forEach(function(t){if(t.classList){var e="";n.classNames&&(e=" js-Pjax-add "+n.classNames.add+" "+(o.backward?n.classNames.forward:n.classNames.backward)),n.callbacks&&n.callbacks.addElement&&n.callbacks.addElement(t),t.className+=e,t.setAttribute("data-pjax-classes",e),r.push(t),s.appendChild(t),l++,h(t,a,c,!0)}}),t.className=e.className,t.appendChild(s)}};Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),o=this,n=function(){},i=function(){return o.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,i.prototype=new n,i});var w="data-pjax-click-state",y="data-pjax-keyup-state",g=function(t,e){if(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)t.setAttribute(w,"modifier");else if(t.protocol===window.location.protocol&&t.host===window.location.host)if(t.pathname===window.location.pathname&&t.hash.length>0)t.setAttribute(w,"anchor-present");else if(t.hash&&t.href.replace(t.hash,"")===window.location.href.replace(location.hash,""))t.setAttribute(w,"anchor");else if(t.href!==window.location.href.split("#")[0]+"#"){if(e.preventDefault(),this.options.currentUrlFullReload&&t.href===window.location.href.split("#")[0])return t.setAttribute(w,"reload"),void this.reload();this.options.requestOptions=this.options.requestOptions||{},t.setAttribute(w,"load"),this.loadUrl(t.href,l(this.options))}else t.setAttribute(w,"anchor-empty");else t.setAttribute(w,"external")},v=function(t){return t.defaultPrevented||!1===t.returnValue};var b="data-pjax-submit-state",j=function(t,e){this.options.requestOptions={requestUrl:t.getAttribute("action")||window.location.href,requestMethod:t.getAttribute("method")||"GET"};var o=document.createElement("a");if(o.setAttribute("href",this.options.requestOptions.requestUrl),o.protocol===window.location.protocol&&o.host===window.location.host)if(o.pathname===window.location.pathname&&o.hash.length>0)t.setAttribute(b,"anchor-present");else if(o.href!==window.location.href.split("#")[0]+"#")if(this.options.currentUrlFullReload)t.setAttribute(b,"reload");else{e.preventDefault();var n=[],i=[];for(var r in t.elements){var s=t.elements[r];if(s.name&&void 0!==s.attributes&&"button"!==s.tagName.toLowerCase()&&("checkbox"!==s.type&&"radio"!==s.type||s.checked)&&-1===n.indexOf(s.name)){if(n.push(s.name),"select"===String(s.nodeName).toLowerCase()&&1==s.multiple){var a=Array.from(s.options).map(function(t){return t.selected?t.value:null});return void i.push({name:encodeURIComponent(s.name),value:a})}i.push({name:encodeURIComponent(s.name),value:encodeURIComponent(s.value)})}}var c=i.map(function(t){return t.name+"="+t.value}).join("&");this.options.requestOptions.requestPayload=i,this.options.requestOptions.requestPayloadString=c,t.setAttribute(b,"submit"),this.loadUrl(o.href,l(this.options))}else t.setAttribute(b,"anchor-empty");else t.setAttribute(b,"external")},x=function(t){return t.defaultPrevented||!1===t.returnValue};var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(t,e){t(e={exports:{}},e.exports)}(function(t){!function(e){var o=setTimeout;function n(){}function i(t){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],u(t,this)}function r(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,i._immediateFn(function(){var o=1===t._state?e.onFulfilled:e.onRejected;if(null!==o){var n;try{n=o(t._value)}catch(t){return void a(e.promise,t)}s(e.promise,n)}else(1===t._state?s:a)(e.promise,t._value)})):t._deferreds.push(e)}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var o=e.then;if(e instanceof i)return t._state=3,t._value=e,void l(t);if("function"==typeof o)return void u((n=o,r=e,function(){n.apply(r,arguments)}),t)}t._state=1,t._value=e,l(t)}catch(e){a(t,e)}var n,r}function a(t,e){t._state=2,t._value=e,l(t)}function l(t){2===t._state&&0===t._deferreds.length&&i._immediateFn(function(){t._handled||i._unhandledRejectionFn(t._value)});for(var e=0,o=t._deferreds.length;e<o;e++)r(t,t._deferreds[e]);t._deferreds=null}function c(t,e,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=o}function u(t,e){var o=!1;try{t(function(t){o||(o=!0,s(e,t))},function(t){o||(o=!0,a(e,t))})}catch(t){if(o)return;o=!0,a(e,t)}}i.prototype.catch=function(t){return this.then(null,t)},i.prototype.then=function(t,e){var o=new this.constructor(n);return r(this,new c(t,e,o)),o},i.all=function(t){return new i(function(e,o){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var n=Array.prototype.slice.call(t);if(0===n.length)return e([]);var i=n.length;function r(t,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){r(t,e)},o)}n[t]=s,0==--i&&e(n)}catch(t){o(t)}}for(var s=0;s<n.length;s++)r(s,n[s])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(t){return new i(function(e,o){o(t)})},i.race=function(t){return new i(function(e,o){for(var n=0,i=t.length;n<i;n++)t[n].then(e,o)})},i._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){o(t,0)},i._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},i._setImmediateFn=function(t){i._immediateFn=t},i._setUnhandledRejectionFn=function(t){i._unhandledRejectionFn=t},t.exports?t.exports=i:e.Promise||(e.Promise=i)}(E)});function A(t){var e=this.options.mainScriptElement,o=t.text||t.textContent||t.innerHTML||"";if(this.log.log("Evaluating Script: ",t),o.match("document.write"))return console&&this.options.logObject.log&&this.options.logObject.log("Script contains document.write. Can’t be executed correctly. Code skipped ",t),!1;var n=t.src||"",i=t.parentNode||document.querySelector(e)||document.documentElement,r=document.createElement("script"),s=new Promise(function(t){if(r.type="text/javascript",""!=n&&(r.src=n,r.addEventListener("load",function(){t(n)}),r.async=!0),""!=o){try{r.appendChild(document.createTextNode(o))}catch(t){r.text=o}t("text-node")}});return this.log.log("ParentElement => ",i),i.appendChild(r),i.removeChild(r),["head","body"].indexOf(i.tagName.toLowerCase())>0||this.options.removeScriptsAfterParsing,s}function P(t,e,o,n){(e="string"==typeof e?e.split(" "):e).forEach(function(e){s(t,function(t){t.removeEventListener(e,o,n)})})}var k="data-pjax-click-state",S="data-pjax-keyup-state",U=function(t,e){if(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)t.setAttribute(k,"modifier");else if(t.protocol===window.location.protocol&&t.host===window.location.host)if(t.pathname===window.location.pathname&&t.hash.length>0)t.setAttribute(k,"anchor-present");else if(t.hash&&t.href.replace(t.hash,"")===window.location.href.replace(location.hash,""))t.setAttribute(k,"anchor");else if(t.href!==window.location.href.split("#")[0]+"#"){if(e.preventDefault(),this.options.currentUrlFullReload&&t.href===window.location.href.split("#")[0])return t.setAttribute(k,"reload"),void this.reload();this.options.requestOptions=this.options.requestOptions||{},t.setAttribute(k,"load"),this.loadUrl(t.href,l(this.options))}else t.setAttribute(k,"anchor-empty");else t.setAttribute(k,"external")},O=function(t){return t.defaultPrevented||!1===t.returnValue};var T="data-pjax-click-state",_=function(t,e){this.options.requestOptions={requestUrl:t.getAttribute("action")||window.location.href,requestMethod:t.getAttribute("method")||"GET"};var o=document.createElement("a");if(o.setAttribute("href",this.options.requestOptions.requestUrl),o.protocol===window.location.protocol&&o.host===window.location.host)if(o.pathname===window.location.pathname&&o.hash.length>0)t.setAttribute(T,"anchor-present");else if(o.href!==window.location.href.split("#")[0]+"#")if(this.options.currentUrlFullReload)t.setAttribute(T,"reload");else{e.preventDefault();var n=[],i=[];for(var r in t.elements){var s=t.elements[r];s.name&&void 0!==s.attributes&&"button"!==s.tagName.toLowerCase()&&("checkbox"!==s.type&&"radio"!==s.type||s.checked)&&-1===n.indexOf(s.name)&&(n.push(s.name),i.push({name:encodeURIComponent(s.name),value:encodeURIComponent(s.value)}))}var a=i.map(function(t){return t.name+"="+t.value}).join("&");this.options.requestOptions.requestPayload=i,this.options.requestOptions.requestPayloadString=a,t.setAttribute(T,"submit"),this.loadUrl(o.href,l(this.options))}else t.setAttribute(T,"anchor-empty");else t.setAttribute(T,"external")},q=function(t){return t.defaultPrevented||!1===t.returnValue};return new function(){var t=function(){function t(o){var n=this;return e(this,t),this.firstrun=!0,this.oUtilities={forEachEls:s,getElements:a,clone:l,isSupported:c,newUid:u},this.oDomUtils=function(){var t=this;return{refresh:function(e){t.parseDOM(e||document)},reload:function(){window.location.reload()},foreachSelectors:function(t,e,o,n){n=n||document,t.forEach(function(t){s(n.querySelectorAll(t),e,o)})},unattach:function(e){s(t.getElements(e),function(t){P(t,"click"),P(t,"keyup")},t)}}}.call(this),this.oParsers=function(){return{parseElementUnload:function(t){switch(t.tagName.toLowerCase()){case"a":t.hasAttribute("data-pjax-click-state")||this.unattachLink(t);break;case"form":t.hasAttribute("data-pjax-click-state")||this.unattachForm(t);break;default:throw"Pjax can only be applied on <a> or <form> submit"}},parseElement:function(t){switch(t.tagName.toLowerCase()){case"a":t.hasAttribute("data-pjax-click-state")||this.attachLink(t);break;case"form":t.hasAttribute("data-pjax-click-state")||this.attachForm(t);break;default:throw"Pjax can only be applied on <a> or <form> submit"}},parseDOMUnload:function(t){s(this.getElements(t),this.parseElementUnload,this)},parseDOM:function(t){s(this.getElements(t),this.parseElement,this)},parseOptions:function(t){this.options=t,this.options.elements=this.options.elements||"a[href], form[action]",this.options.reRenderCSS=this.options.reRenderCSS||!1,this.options.forceRedirectOnFail=this.options.forceRedirectOnFail||!1,this.options.scriptloadtimeout=this.options.scriptloadtimeout||1e3,this.options.mainScriptElement=this.options.mainScriptElement||"head",this.options.removeScriptsAfterParsing=this.options.removeScriptsAfterParsing||!0,this.options.logObject=this.options.logObject||console,this.options.latestChance=this.options.latestChance||null,this.options.selectors=this.options.selectors||["title",".js-Pjax"],this.options.switches=this.options.switches||{},this.options.switchesOptions=this.options.switchesOptions||{},this.options.history=this.options.history||!0,this.options.onDomDiffers=this.options.onDomDiffers||function(){return!0},this.options.pjaxErrorHandler=this.options.pjaxErrorHandler||function(){return!1},this.options.onJsonDocument=this.options.onJsonDocument||function(){return!0},this.options.analytics=this.options.analytics||function(){window._gaq&&window._gaq.push(["_trackPageview"]),window.ga&&window.ga("send","pageview",{page:location.pathname,title:document.title})},this.options.scrollTo=void 0===this.options.scrollTo?0:this.options.scrollTo,this.options.cacheBust=void 0===this.options.cacheBust||this.options.cacheBust,this.options.debug=this.options.debug||!1,this.options.switches.head||(this.options.switches.head=this.switchElementsAlt),this.options.switches.body||(this.options.switches.body=this.switchElementsAlt),"function"!=typeof t.analytics&&(t.analytics=function(){})}}}.call(this),this.oParsers.parseOptions.call(this,o),this.log=function(){return console.log("PJAX options",this.options),this.options.logObject=new p("PJAX ->",!this.options.debug),this.options.logObject}.call(this),this.doRequest=d,this.getElements=this.oUtilities.getElements,this.parseElementUnload=this.oParsers.parseElementUnload,this.parseElement=this.oParsers.parseElement,this.parseDOM=this.oParsers.parseDOM,this.parseDOMUnload=this.oParsers.parseDOMUnload,this.refresh=this.oDomUtils.refresh,this.reload=this.oDomUtils.reload,this.isSupported=this.oUtilities.isSupported,this.attachLink=function(){var t=this;return function(e){h(e,"click",function(o){v(o)||g.call(t,e,o)}),h(e,"keyup",function(o){v(o)||(o.which>1||o.metaKey||o.ctrlKey||o.shiftKey||o.altKey?e.setAttribute(y,"modifier"):13==o.keyCode&&g.call(t,e,o))})}}.call(this),this.attachForm=function(){var t=this;return function(e){h(e,"submit",function(o){x(o)||j.call(t,e,o)})}}.call(this),this.unattachLink=function(){var t=this;return function(e){P(e,"click",function(o){O(o)||U.call(t,e,o)}),P(e,"keyup",function(o){O(o)||(o.which>1||o.metaKey||o.ctrlKey||o.shiftKey||o.altKey?e.setAttribute(S,"modifier"):13==o.keyCode&&U.call(t,e,o))})}}.call(this),this.unattachForm=function(){var t=this;return function(e){P(e,"submit",function(t){q(t)||_.call(this,e,t)}),P(e,"keyup",function(o){q(o)||13==o.keyCode&&_.call(t,e,o)})}}.call(this),this.updateStylesheets=function(){var t=this;return function(e,o){t.log.log("styleheets old elements",o),t.log.log("styleheets new elements",e),s(e,function(e){if(null!==Array.from(o).reduce(function(t,o){return t=o.href===e.href?o:t},null))t.log&&t.log.log("old stylesheet found not resetting");else{t.log&&t.log.log("new stylesheet => add to head");var n=document.getElementsByTagName("head")[0],i=document.createElement("link");i.setAttribute("href",e.href),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),n.appendChild(i)}})}}.call(this),this.log.log("Pjax options",this.options),this.maxUid=this.lastUid=this.oUtilities.newUid(),this.parseDOM(document),h(window,"popstate",function(t){if(n.log.log("OPT -> ",t),t.state){var e=n.oUtilities.clone(n.options);e.url=t.state.url,e.title=t.state.title,e.history=!1,e.requestOptions={},n.log.log("OPT -> ",e),n.log.log("State UID",t.state.uid),n.log.log("lastUID",n.lastUid),t.state.uid<n.lastUid?e.backward=!0:e.forward=!0,n.lastUid=t.state.uid,n.loadUrl(t.state.url,e)}}),this}return n(t,[{key:"forEachSelectors",value:function(t,e,o){return this.oDomUtils.foreachSelectors(this.options.selectors,t,e,o)}},{key:"switchSelectors",value:function(t,e,o,n){return function(){var t=this;return function(e,o,n,i,r,a){n.forEach(function(n){var l=i.querySelectorAll(n),c=r.querySelectorAll(n);if((t.log.log("Pjax switch",n,l,c),l.length!==c.length)&&a.onDomDiffers(r,i))throw"DOM doesn’t look the same on new loaded page: ’"+n+"’ - new "+l.length+", old "+c.length;s(l,function(t,i){var r=c[i];null!=r&&(this.log.log("newEl",t,"oldEl",r),e[n]?e[n].call(this,r,t,a,o[n]):m.outerHTML.call(this,r,t,a))},t)})}}.call(this)(this.options.switches,this.options.switchesOptions,t,e,o,n)}},{key:"latestChance",value:function(t){return window.location.href=t,!1}},{key:"onSwitch",value:function(){f(window,"resize scroll")}},{key:"loadContent",value:function(t,e){var o=this,n=function(){var t=this;return function(e){t.log.log("Executing scripts for ",e);var o=[];return void 0===e?Promise.resolve():("script"===e.tagName.toLowerCase()&&A.call(t,e),s(e.querySelectorAll("script"),function(e){e.type&&"text/javascript"!==e.type.toLowerCase()||e.parentNode&&"textarea"==e.parentNode.tagName||o.push(A.call(t,e))},t),o)}}.apply(this),i=window.document.implementation.createHTMLDocument("pjax"),r=[Promise.resolve("basic resolve")],a=t.match(/<html[^>]+>/gi);a&&a.length&&(a=a[0].match(/\s?[a-z:]+(?:=(?:'|")[^'">]+(?:'|"))*/gi)).length&&(a.shift(),a.forEach(function(t){var e=t.trim().split("=");1===e.length?i.documentElement.setAttribute(e[0],!0):i.documentElement.setAttribute(e[0],e[1].slice(1,-1))}));var l=null;try{l=JSON.parse(t)}catch(t){this.log.warn("No JSON found. If you expected it there was an error")}if(i.documentElement.innerHTML=t,this.log.log("load content",i.documentElement.attributes,i.documentElement.innerHTML.length),null!==l&&(this.log.log("found JSON document",l),this.options.onJsonDocument.call(this,l)),window.document.activeElement&&!window.document.activeElement.value)try{window.document.activeElement.blur()}catch(t){}this.switchSelectors(this.options.selectors,i,document,e),!0===this.options.reRenderCSS&&this.updateStylesheets(i.querySelectorAll("link[rel=stylesheet]"),document.querySelectorAll("link[rel=stylesheet]"));var c=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();c&&document.activeElement!==c&&c.focus(),this.options.selectors.forEach(function(t){o.oUtilities.forEachEls(document.querySelectorAll(t),function(t){r.push.apply(r,n(t))},o)}),this.log.log("waiting for scriptcomplete",r);var u=null;u=window.setTimeout(function(){f(document,"pjax:scriptcomplete pjax:scripttimeout",e),u=null},this.options.scriptloadtimeout),Promise.all(r).then(function(){null!==u&&(window.clearTimeout(u),f(document,"pjax:scriptcomplete pjax:scriptsuccess",e))},function(){null!==u&&(window.clearTimeout(u),f(document,"pjax:scriptcomplete pjax:scripterror",e))})}},{key:"loadUrl",value:function(t,e){var o=this;this.log.log("load href",t,e),f(document,"pjax:send",e),this.doRequest(t,e.requestOptions,function(n,i){if(!1===n||200!==i.status)return f(document,"pjax:complete pjax:error",{options:e,requestData:i,href:t}),e.pjaxErrorHandler(t,e,i);document.activeElement.blur();try{o.loadContent(n,e)}catch(n){if(o.options.debug){if(o.options.forceRedirectOnFail)return e.pjaxErrorHandler(t,e,i)||o.latestChance(t);throw n}return console&&o.options.logObject.error&&o.options.logObject.error("Pjax switch fail: ",n),e.pjaxErrorHandler(t,e,i)||o.latestChance(t)}e.history&&(o.firstrun&&(o.lastUid=o.maxUid=o.oUtilities.newUid(),o.firstrun=!1,window.history.replaceState({url:window.location.href,title:document.title,uid:o.maxUid},document.title)),o.lastUid=o.maxUid=o.oUtilities.newUid(),window.history.pushState({url:t,title:e.title,uid:o.maxUid},e.title,t)),o.forEachSelectors(function(t){return o.parseDOM(t)}),f(document,"pjax:complete pjax:success",e),e.analytics(),!1!==e.scrollTo&&(e.scrollTo.length>1?window.scrollTo(e.scrollTo[0],e.scrollTo[1]):window.scrollTo(0,e.scrollTo))})}}]),t}();if(!c()){console.warn("Pjax not supported");var o=function(){};for(var i in t.prototype)i in t.prototype&&"function"==typeof t.prototype[i]&&(o[i]=o);return o}return t}});"use strict";var switchOuterHTML=function(t,e,o){o=o||{};var n=$(t).parent();$(t).off().remove(),n.append(e),this.onSwitch()},switchInnerHTML=function(t,e,o){o=o||{};$(t).parent();$(t).off().html(""),$(t).html($(e).html()),this.onSwitch()},singletonPjax=function(){return window.activePjax=window.activePjax||null,null===window.activePjax&&(console.ls.log("creating a Pjax instance on the window object"),window.activePjax=new Pjax({elements:["a.pjax","form.pjax"],selectors:["#pjax-content","#breadcrumb-container","#bottomScripts","#beginScripts"],debug:window.debugState.backend,forceRedirectOnFail:!0,reRenderCSS:!0,scriptloadtimeout:1500})),window.activePjax},forceRefreshPjax=function(){window.activePjax=null,singletonPjax()},unsetPjax=function(){window.activePjax.parseDOMtoUnload(),$("a.pjax").off("click"),window.activePjax=null},triggerLoadUrl=function(t,e){singletonPjax().loadUrl(e.url,singletonPjax().options)},reparseDocument=function(){singletonPjax().parseDOM(document)};window.singletonPjax=singletonPjax,$(document).off("pjax:reload"),$(document).off("pjax:create"),$(document).off("pjax:refresh"),$(document).off("pjax:load"),$(document).off("pjax:unload"),$(document).on("pjax:reload",forceRefreshPjax),$(document).on("pjax:create",singletonPjax),$(document).on("pjax:refresh",reparseDocument),$(document).on("pjax:load",triggerLoadUrl),$(document).on("pjax:unload",unsetPjax);